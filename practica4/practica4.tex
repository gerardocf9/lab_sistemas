
%\documentclass[10pt]{article}


\section{Programa DOS}

El código comentado se adjunta en el archivo (dos/lectura.asm)
%\lstinputlisting[language={[x86masm]Assembler}]{practica4/dos/lectura.asm}




\section{Programa consola}

El código comentado se adjunta en el archivo (consola/lectura.asm)\\



inicialmente es directivas e inclusión de librerías, luego viene el prototipo
de funciones y el macro que permiten el controlar la entrada y salida de datos.
Cabe resaltar que se utilizo como modelo la practica 2, posteriormente,
vienen los segmentos de data y código:\\


En el segmento de data inicializada \comillas{\textbf{.DATA}} se encuentran:

\begin{itemize}
    \item \comillas{Msg1} el cual es un mensaje que indica al usuario cuando
        debe ingresar un path o el nombre del archivo.

    \item \comillas{Msg4} mensaje que indica la salida del programa.

    \item \comillas{CRLF} string dedicada a dejar una linea en blanco.
\end{itemize}

\vspace{0.5cm}

En el segmento de data sin inicializar \comillas{\textbf{.DATA?}} se encuentran:

\begin{itemize}
    \item \comillas{inbuf} buffer para la lectura de datos.

    \item \comillas{hfile} \comillas{puntero} a la dirección de la fila que se
        leerá.

    \item \comillas{FileSize} espacio para el tamaño, en bytes, del fichero.

    \item \comillas{hMem} \comillas{puntero} a la memoria creada con el contenido
        del fichero.

    \item \comillas{BytesRead} cantidad de bytes que se leyeron.

\end{itemize}

\vspace{0.5cm}

Posteriormente, comienza el código que básicamente es ejecutar \comillas{syscall}
a través de la directiva \comillas{INVOKE}.


Primero se pide por consola y se lee por la misma el nombre o path de la fila
que se abrirá. Una vez recibido se usa la api de windows con \comillas{CreateFile} para
abrir la fila \Cite{MicrosoftCreateFileA}, este devuelve la dirección en \comillas{eax}
por lo tanto se mueve a hfile. Luego, se utiliza la api nuevamente con \comillas{GetFileSize}
\Cite{Windowsgetsize} y se mueve el valor devuelto de \comillas{eax} a
\comillas{FileSize}, se incrementa el valor de \comillas{eax} para al pedir
memoria dinámicamente, necesario si la fila es muy grande, poder agregar el
carácter de terminación y usar de forma segura la función de escritura.


Se pide la memoria dinámica con la api \comillas{GlobalAlloc} \Cite{GlobalAlloc},
se guarda en \comillas{hMem}, se le da el valor del tamaño de la fila de nuevo a
\comillas{eax} para poder usarlo como puntero y darle el valor \comillas{0}
(carácter de terminación) a \comillas{hMem} (espacio para el contenido de la
fila + carácter terminación).


Finalmente se lee el contenido con la función de la api ReadFile
\Cite{MicrosoftReadFile} se cierra la fila con \comillas{CloseHandle}
\Cite{CloseHandle}
luego se imprime por pantalla el contenido de la fila. Se libera la memoria con
\comillas{GlobalFree} y para que se visualice correctamente el resultado, se
imprime un salto de linea y se manda a leer esperando por un enter para finalizar.


El programa termina con \comillas{Invoke ExitProcess} para terminar la ejecución
correctamente.


%\lstinputlisting[language={[x86masm]Assembler}]{practica4/consola/lectura.asm}



\section{Programa ventana}

El código comentado se adjunta en el archivo (ventana/lectura.asm)
%\lstinputlisting[language={[x86masm]Assembler}]{practica4/ventana/lectura.asm}
